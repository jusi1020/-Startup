<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë°€ì–‘ì—­ â†” ë¶€ì‚°ëŒ€ ë²„ìŠ¤ì‹œê°„í‘œ</title>
  <meta name="build" content="2025-09-28T17:20+09:00-json-only-no-seconds" />
  <style>
    :root { --bg:#0b0b0c; --border:#23232a; --text:#e9e9ee; --muted:#979aa1; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple SD Gothic Neo,Malgun Gothic,Noto Sans KR,'ë§‘ì€ ê³ ë”•',sans-serif;color:var(--text);background:radial-gradient(1000px 500px at 10% -20%,#182033 0%,#0d101a 40%,var(--bg) 80%);}
    .wrap{max-width:980px;margin:40px auto;padding:0 16px}
    header h1{font-size:28px;margin:0 0 4px} header p{margin:0;color:var(--muted);font-size:14px}
    .card{background:linear-gradient(180deg,#171922,#12131a);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.35);overflow:hidden;margin-top:20px}
    .toolbar{display:flex;gap:10px;padding:14px;border-bottom:1px solid var(--border);align-items:center;background:rgba(255,255,255,.02)}
    .btn{appearance:none;border:1px solid var(--border);background:#191a21;color:#e9e9ee;font-weight:600;padding:10px 14px;border-radius:10px;cursor:pointer;transition:transform .06s,border-color .2s,background .2s}
    .btn:hover{transform:translateY(-1px)} .btn.primary{background:linear-gradient(180deg,#27314a,#1f2740);border-color:#2a3a64}
    .submenu{display:none;gap:8px;padding:12px 14px;border-bottom:1px dashed var(--border)} .submenu.open{display:flex;flex-wrap:wrap}
    .tabs{display:flex;gap:6px;padding:12px 14px;border-bottom:1px dashed var(--border)} .tab{border:1px solid var(--border);background:#14151b;color:#979aa1;padding:6px 10px;border-radius:999px;cursor:pointer;font-size:13px} .tab.active{color:#fff;border-color:#34406a;background:#21263b}
    .content{padding:16px} .title-row{display:flex;gap:10px;align-items:baseline;margin-bottom:8px} .title-row h2{margin:0;font-size:20px;font-weight:700} .title-row .meta{font-size:12px;color:#979aa1}
    table{width:100%;border-collapse:collapse;border-radius:12px;border:1px solid var(--border);background:#0f1118;overflow:hidden}
    thead th{background:#171a24;color:#d6d8de;text-align:left;padding:10px 12px;font-size:13px;border-bottom:1px solid var(--border)}
    tbody td{border-top:1px solid var(--border);padding:9px 12px;font-size:14px;color:#e8eaf0} tbody tr:hover{background:rgba(255,255,255,.02)}
    .empty{padding:24px;text-align:center;color:#979aa1}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ë°€ì–‘ â†” ë¶€ì‚°ëŒ€ ë²„ìŠ¤ì‹œê°„í‘œ</h1>
      <p>ë²„ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ë°©í–¥(í•™êµë¡œ / ì—­ìœ¼ë¡œ)ê³¼ ìš”ì¼(í‰ì¼ / ì£¼ë§Â·ê³µíœ´ì¼ / ë°©í•™)ì„ ì„ íƒí•˜ì„¸ìš”.</p>
    </header>

    <section class="card">
      <div class="toolbar">
        <button id="busBtn" class="btn primary">ğŸšŒ ë²„ìŠ¤</button>
        <span id="status" style="display:none;border:1px solid #203847;background:#14222b;color:#9cc7da;padding:4px 8px;border-radius:999px;font-size:12px">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</span>
      </div>

      <div id="submenu" class="submenu">
        <button id="toSchoolBtn" class="btn">í•™êµë¡œ <span class="meta" style="opacity:.75;font-weight:500">(ë°€ì–‘â†’ë¶€ì‚°ëŒ€)</span></button>
        <button id="toStationBtn" class="btn">ì—­ìœ¼ë¡œ <span class="meta" style="opacity:.75;font-weight:500">(ë¶€ì‚°ëŒ€â†’ë°€ì–‘)</span></button>
      </div>

      <div id="dayTabs" class="tabs" style="display:none">
        <button class="tab" data-day="í‰ì¼">í‰ì¼</button>
        <button class="tab" data-day="ì£¼ë§Â·ê³µíœ´ì¼">ì£¼ë§Â·ê³µíœ´ì¼</button>
        <button class="tab" data-day="ë°©í•™">ë°©í•™</button>
      </div>

      <div id="content" class="content">
        <div class="empty">ë°©í–¥ì„ ì„ íƒí•˜ë©´ ì‹œê°„í‘œê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </section>
  </div>

  <script>
    const STATE = { loaded:false, data:{toSchool:[],toStation:[]}, direction:null, dayType:'í‰ì¼' };
    const $ = s => document.querySelector(s); const $$ = s => Array.from(document.querySelectorAll(s));
    function showStatus(msg, show=true){ const s=$("#status"); if(!s) return; s.textContent=msg; s.style.display=show?"inline-flex":"none"; }

    // Strip seconds; handle 'ì˜¤ì „/ì˜¤í›„' and 'AM/PM'
    function fmtTime(v){
      if(v==null) return "";
      let s = String(v).trim();
      if(!s) return "";
      // ì˜¤ì „/ì˜¤í›„ h:mm[:ss]
      let m = s.match(/^(ì˜¤ì „|ì˜¤í›„)\s*(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?/);
      if(m){
        let h = parseInt(m[2],10), min = m[3].padStart(2,"0");
        const isPM = m[1]==="ì˜¤í›„";
        if(isPM && h!==12) h+=12;
        if(!isPM && h===12) h=0;
        return String(h).padStart(2,"0")+":"+min;
      }
      // h:mm[:ss] AM/PM
      m = s.match(/^(\d{1,2}):(\d{2})(?::\d{2})?\s*(AM|PM)$/i);
      if(m){
        let h = parseInt(m[1],10), min = m[2];
        const isPM = m[3].toUpperCase()==="PM";
        if(isPM && h!==12) h+=12;
        if(!isPM && h===12) h=0;
        return String(h).padStart(2,"0")+":"+min;
      }
      // h:mm or h:mm:ss
      m = s.match(/^(\d{1,2}):(\d{2})(?::\d{2})?$/);
      if(m){
        return m[1].padStart(2,"0")+":"+m[2];
      }
      return s;
    }

    async function ensureDataLoaded(){
      if(STATE.loaded) return;
      showStatus("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦", true);
      try{
        const res = await fetch("./bus_schedule.json", { cache:"no-store" });
        if(!res.ok) throw new Error("bus_schedule.json ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ ("+res.status+")");
        const j = await res.json();
        STATE.data = j;
        STATE.loaded = true;
      }catch(e){
        console.error(e); alert(e.message || e);
      }finally{
        showStatus("", false);
      }
    }

    function setActiveTab(d){ $$("#dayTabs .tab").forEach(t=>t.classList.toggle("active",t.dataset.day===d)); }
    function renderTable(dir,day){
      const content=$("#content"); const rows=(STATE.data[dir]||[]).filter(d=>d.day_type===day); content.innerHTML="";
      const title=document.createElement("div"); title.className="title-row";
      const h2=document.createElement("h2"); h2.textContent=dir==="toSchool"?"ë°€ì–‘ â†’ ë¶€ì‚°ëŒ€ (í•™êµë¡œ)":"ë¶€ì‚°ëŒ€ â†’ ë°€ì–‘ (ì—­ìœ¼ë¡œ)";
      const meta=document.createElement("span"); meta.className="meta"; meta.textContent=`ìš”ì¼: ${day}`; title.appendChild(h2); title.appendChild(meta); content.appendChild(title);
      if(rows.length===0){ const e=document.createElement("div"); e.className="empty"; e.textContent="í•´ë‹¹ ì¡°ê±´ì˜ ì‹œê°„í‘œê°€ ì—†ìŠµë‹ˆë‹¤."; content.appendChild(e); return; }
      const cols=dir==="toSchool"?["íšŒì°¨","ì‹œê°„","ì˜ë‚¨ë£¨","ë°€ì–‘ì—­","ë¶€ì‚°ëŒ€"]:["íšŒì°¨","ì‹œê°„","ë¶€ì‚°ëŒ€","ë°€ì–‘ì—­","ì˜ë‚¨ë£¨"];
      const table=document.createElement("table"); const thead=document.createElement("thead"); const trh=document.createElement("tr"); for(const c of cols){ const th=document.createElement("th"); th.textContent=c; trh.appendChild(th);} thead.appendChild(trh); table.appendChild(thead);
      const tbody=document.createElement("tbody");
      for(const r of rows){
        const tr=document.createElement("tr");
        const arr=dir==="toSchool"?[r.run||"",fmtTime(r.t["ì‹œê°„"]||""),fmtTime(r.t["ì˜ë‚¨ë£¨"]||""),fmtTime(r.t["ë°€ì–‘ì—­"]||""),fmtTime(r.t["ë¶€ì‚°ëŒ€"]||"")]
                                 :[r.run||"",fmtTime(r.t["ì‹œê°„"]||""),fmtTime(r.t["ë¶€ì‚°ëŒ€"]||""),fmtTime(r.t["ë°€ì–‘ì—­"]||""),fmtTime(r.t["ì˜ë‚¨ë£¨"]||"")];
        for(const v of arr){ const td=document.createElement("td"); td.textContent=v; tr.appendChild(td); } tbody.appendChild(tr);
      }
      table.appendChild(tbody); content.appendChild(table);
    }

    function initUI(){
      $("#busBtn").addEventListener("click", async () => {
        const m=$("#submenu"); m.classList.toggle("open"); $("#dayTabs").style.display=m.classList.contains("open")?"flex":"none";
        if(m.classList.contains("open")&&!STATE.loaded){ await ensureDataLoaded(); }
      });
      $("#toSchoolBtn").addEventListener("click", async () => {
        if(!STATE.loaded) await ensureDataLoaded(); STATE.direction="toSchool"; $("#dayTabs").style.display="flex"; setActiveTab(STATE.dayType); renderTable(STATE.direction,STATE.dayType);
      });
      $("#toStationBtn").addEventListener("click", async () => {
        if(!STATE.loaded) await ensureDataLoaded(); STATE.direction="toStation"; $("#dayTabs").style.display="flex"; setActiveTab(STATE.dayType); renderTable(STATE.direction,STATE.dayType);
      });
      $$("#dayTabs .tab").forEach(tab=>tab.addEventListener("click",()=>{ STATE.dayType=tab.dataset.day; setActiveTab(STATE.dayType); if(STATE.direction) renderTable(STATE.direction,STATE.dayType);}));
    }
    document.addEventListener("DOMContentLoaded", initUI);
  </script>
</body>
</html>
